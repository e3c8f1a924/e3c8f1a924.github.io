首先有一个明显的贪心策略：优先取 $i+j+k$ 最大的点 $(i,j,k)$ 最优。

然后把三个图并在一起很棘手，可以先考虑对于每一个图怎么处理。

先把图 $X$ 中的边定向为由编号低的点连向编号高的点，那么一个点被选择当且仅当其所有后继节点都没被选择，一个点没被选择当且仅当其有一个后继节点被选择。

这个选择过程和博弈很像。一个点被选择，可以看成它属于必败态，没被选择，可以看成它属于必胜态。这个过程可以通过拓扑排序解决。

对于图 $Y$，$Z$ 类似。

接下来考虑 $W$ 怎么做。可以发现，$W$ 可以表示为 $X$，$Y$，$Z$ 三个游戏，每次可以选择一个游戏进行操作。这适用 $\mathrm{SG}$ 定理。

于是可以对 $X$，$Y$，$Z$ 预处理出每个点的 $\mathrm{SG}$ 函数值 $\mathrm{SG}(X/Y/Z,u)$，然后答案便是：

$$
\sum_{\mathrm{SG}(X,i)\oplus\mathrm{SG}(Y,j)\oplus\mathrm{SG}(Z,k)=0}10^{18(i+j+k)}
$$

直接枚举点是 $\mathcal O(N^3)$ 的。考虑到每个点的 $\mathrm{SG}$ 函数值不是很大，大概是 $\mathcal O(\sqrt M)$ 的样子。所以可以开三个桶，枚举 $\mathrm{SG}$ 函数值进行计算。

复杂度（默认 $N$ 和 $M_{1\dots 3}$ 同阶） $\mathcal O(N)$。
